#### **navigator.mediaDevices.getUserMedia**

​	该api用于获取设备的摄像头或者麦克风。

​	顾名思义，**获取用户层面的媒体设备**，计算机通过usb等等其他网络形式接入的多个摄像头或者虚拟设备都可以通过该**API**获取到，其中可获取的不仅仅是视频设备，还包括音频设备以及虚拟音频设备。获取媒体设备仅仅是最基础的操作，**它还可以控制获取到的媒体设备的分辨率以及其他一些可选项。**



#### navigator.mediaDevices.enumerateDevices

​	该api用于获取设备所有的媒体设备。

​	在调用这个函数之前，需要先行调用**getUserMedia**函数，它的出现是用户在访问服务时直接调用用户摄像头，此时如果用户授权且同意使用设备摄像头、麦克风，那么**enumerateDevices**函数就能获取设备信息了，在这里**getUserMedia**函数可以理解为获取摄像头或者麦克风权限集合的**探路函数**。



#### 媒体约束 constraints

​	当设备存在摄像头和麦克风时，用以下方式获取没有任何问题。

```js
let constraints = { video: true, audio: true };

function handleError(error) {
	console.error('navigator.MediaDevices.getUserMedia error: ', error.message, error.name);
}

// 获取设备
function getLocalUserMedia(constraints) {
	 return await navigator.mediaDevices.getUserMedia(constraints)
}

let stream = await this.getLocalUserMedia(constraints).catch(handleError);
console.log(stream);

```

​	以上代码用于获取设备的媒体流，但该情况仅限于设备配备音视频设备的情况，**若存在没有设备或是有多个设备的情况，则需要使用constraints进行媒体约束**。

```js
		async getTargetDeviceMedia(videoId,audioId){
			const constraints = {
        // 获取音频设备
				audio: {deviceId: audioId ? {exact: audioId} : undefined},
				video: {
          // 获取视频设备
					deviceId: videoId ? {exact: videoId} : undefined,
          // 获取分辨率
					width:this.formInline.width,
					height:this.formInline.height,
          // 获取帧率
					frameRate: { ideal: this.formInline.frameRate, max: 24 }
				}
			};
			if (window.stream) {
				window.stream.getTracks().forEach(track => {
					track.stop();
				});
			}
			return await this.getLocalUserMedia(constraints).catch(handleError);
		},
```

​	以上是媒体约束的一些基本参数和用法，同时在引入了帧率约束后，衍生出一些使用场景，**在特定的场合可以选择特定的fps搭配前面的分辨率配置，以提高会议系统的质量**，例如：

	1. 屏幕分享过程中，应当重视画面的分辨率而不是帧率，有些许卡顿问题不大。
 	2. 在普通会议场景，应当重视画面的流畅程度而不是分辨率，所以应当提高帧速率而不是分辨率。
 	3. 在开会人数多但宽带又受限的情况下，我们重视的同样是会议的流程性，同样低分辨率更适合宽带受限的多人会议。



#### getDisplayMedia

​	日常开会多数需要通过会议 App 来分享自己的屏幕，或者仅分享桌面上固定的应用程序那么在浏览器中实现视频通话，可以使用在 [Screen Capture](https://link.juejin.cn/?target=https%3A%2F%2Fw3c.github.io%2Fmediacapture-screen-share%2F) 标准中有说明的**getDisplayMedia**实现分享屏幕，该api同样存在媒体约束constraints。

```js
// 获取屏幕分享的媒体流
async function getShareMedia(){
    const constraints = {
        video:{width:1920,height:1080},
        audio:false
    };
    if (window.stream) {
        window.stream.getTracks().forEach(track => {
            track.stop();
        });
    }
    return await navigator.mediaDevices.getDisplayMedia(constraints).catch(handleError);
}
```

